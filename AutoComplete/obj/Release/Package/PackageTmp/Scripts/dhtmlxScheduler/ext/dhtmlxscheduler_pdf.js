/*
Copyright DHTMLX LTD. http://www.dhtmlx.com
To use this component please contact sales@dhtmlx.com to obtain license
*/
Scheduler.plugin(function(d){(function(){function g(b){return b.replace(newline_regexp,"\n").replace(html_regexp,"")}function n(b){var b=parseFloat(b),d=C(b),b=b-d.width+d.cols*dx;return isNaN(b)?"auto":100*b/dx}function C(b){for(var f=0,c=d._els.dhx_cal_header[0].childNodes[0].childNodes,a=0;a<c.length;a++){var e=c[a].style?c[a]:c[a].parentNode,h=parseFloat(e.style.width);if(b>h)b-=h+1,f+=h+1;else break}return{width:f,cols:a}}function w(b){b=parseFloat(b);return isNaN(b)?"auto":100*b/dy}function s(b){var f=
"";if(d.matrix&&d.matrix[d._mode]){if(d.matrix[d._mode].second_scale)var c=b[1].childNodes;b=b[0].childNodes}for(var a=0;a<b.length;a++)f+="\n<column><![CDATA["+g(b[a].innerHTML)+"]]\></column>";dx=b[0].offsetWidth;if(c)for(var e=0,h=b[0].offsetWidth,j=1,a=0;a<c.length;a++)f+="\n<column second_scale='"+j+"'><![CDATA["+g(c[a].innerHTML)+"]]\></column>",e+=c[a].offsetWidth,e>=h&&(h+=b[j]?b[j].offsetWidth:0,j++),dx=c[0].offsetWidth;return f}function D(b,f){for(var c=parseInt(b.style.left,10),a=0;a<d._cols.length;a++)if(c-=
d._cols[a],c<0)return a;return f}function E(b,f){for(var c=parseInt(b.style.top,10),a=0;a<d._colsS.heights.length;a++)if(d._colsS.heights[a]>c)return a;return f}function t(b){for(var d="",c=b.firstChild.rows,a=0;a<c.length;a++){for(var e=[],h=0;h<c[a].cells.length;h++)e.push(c[a].cells[h].firstChild.innerHTML);d+="\n<row height='"+b.firstChild.rows[a].cells[0].offsetHeight+"'><![CDATA["+g(e.join("|"))+"]]\></row>";dy=b.firstChild.rows[0].cells[0].offsetHeight}return d}function u(b,d,c,a){var e="<"+
b+" profile='"+d+"'";c&&(e+=" header='"+c+"'");a&&(e+=" footer='"+a+"'");e+=">";return e}function F(b){return b?"<"+b+">":""}function o(b){return b?"</"+b+">":""}function y(){var b="",f=d._mode;d.matrix&&d.matrix[d._mode]&&(f="timeline");b+="<scale mode='"+f+"' today='"+d._els.dhx_cal_date[0].innerHTML+"'>";if(d._mode=="week_agenda")for(var c=d._els.dhx_cal_data[0].getElementsByTagName("DIV"),a=0;a<c.length;a++)c[a].className=="dhx_wa_scale_bar"&&(b+="<column>"+g(c[a].innerHTML)+"</column>");else if(d._mode==
"agenda"||d._mode=="map")c=d._els.dhx_cal_header[0].childNodes[0].childNodes,b+="<column>"+g(c[0].innerHTML)+"</column><column>"+g(c[1].innerHTML)+"</column>";else if(d._mode=="year"){c=d._els.dhx_cal_data[0].childNodes;for(a=0;a<c.length;a++)b+="<month label='"+g(c[a].childNodes[0].innerHTML)+"'>",b+=s(c[a].childNodes[1].childNodes),b+=t(c[a].childNodes[2]),b+="</month>"}else{b+="<x>";c=d._els.dhx_cal_header[0].childNodes;b+=s(c);b+="</x>";var e=d._els.dhx_cal_data[0];if(d.matrix&&d.matrix[d._mode]){b+=
"<y>";for(a=0;a<e.firstChild.rows.length;a++){var h=e.firstChild.rows[a];b+="<row><![CDATA["+g(h.cells[0].innerHTML)+"]]\></row>"}b+="</y>";dy=e.firstChild.rows[0].cells[0].offsetHeight}else if(e.firstChild.tagName=="TABLE")b+=t(e);else{for(e=e.childNodes[e.childNodes.length-1];e.className.indexOf("dhx_scale_holder")==-1;)e=e.previousSibling;e=e.childNodes;b+="<y>";for(a=0;a<e.length;a++)b+="\n<row><![CDATA["+g(e[a].innerHTML)+"]]\></row>";b+="</y>";dy=e[0].offsetHeight}}b+="</scale>";return b}function i(b,
d){return(window.getComputedStyle?window.getComputedStyle(b,null)[d]:b.currentStyle?b.currentStyle[d]:null)||""}function z(b){var f="",c=d._rendered;if(d._mode=="agenda"||d._mode=="map")for(var a=0;a<c.length;a++)f+="<event><head>"+g(c[a].childNodes[0].innerHTML)+"</head><body>"+g(c[a].childNodes[2].innerHTML)+"</body></event>";else if(d._mode=="week_agenda")for(a=0;a<c.length;a++)f+="<event day='"+c[a].parentNode.getAttribute("day")+"'><body>"+g(c[a].innerHTML)+"</body></event>";else if(d._mode==
"year"){c=d.get_visible_events();for(a=0;a<c.length;a++){var e=c[a].start_date;if(e.valueOf()<d._min_date.valueOf())e=d._min_date;for(;e<c[a].end_date;){var h=e.getMonth()+12*(e.getFullYear()-d._min_date.getFullYear())-d.week_starts._month,j=d.week_starts[h]+e.getDate()-1,k=b?i(d._get_year_cell(e),"color"):"",l=b?i(d._get_year_cell(e),"backgroundColor"):"";f+="<event day='"+j%7+"' week='"+Math.floor(j/7)+"' month='"+h+"' backgroundColor='"+l+"' color='"+k+"'></event>";e=d.date.add(e,1,"day");if(e.valueOf()>=
d._max_date.valueOf())break}}}else{var A=d.matrix&&d.matrix[d._mode];if(A&&A.render=="cell"){c=d._els.dhx_cal_data[0].getElementsByTagName("TD");for(a=0;a<c.length;a++)k=b?i(c[a],"color"):"",l=b?i(c[a],"backgroundColor"):"",f+="\n<event><body backgroundColor='"+l+"' color='"+k+"'><![CDATA["+g(c[a].innerHTML)+"]]\></body></event>"}else for(a=0;a<c.length;a++){var m=n(c[a].style.left),r=n(c[a].style.width);if(!isNaN(r*1)){var p=w(c[a].style.top),q=w(c[a].style.height),o=c[a].className.split(" ")[0].replace("dhx_cal_",
"");if(o!=="dhx_tooltip_line"){var x=d.getEvent(c[a].getAttribute("event_id")),j=x._sday,v=x._sweek,s=x._length||0;if(d._mode!="month"){if(d.matrix&&d.matrix[d._mode]){var j=0,t=c[a].parentNode.parentNode.parentNode,v=t.rowIndex;r+=n(10)}else{d.xy.menu_width&&(r+=n(r*20/100),m-=n(15-m*20/100));if(c[a].parentNode==d._els.dhx_cal_data[0])continue;m+=n(c[a].parentNode.style.left);m-=n(51)}if(d.matrix&&d.matrix[d._mode]){var u=dy;dy=c[a].parentNode.offsetHeight;p=w(c[a].style.top);p-=p*0.2;dy=u}}else q=
parseInt(c[a].offsetHeight,10),p=parseInt(c[a].style.top,10)-22,j=D(c[a],j),v=E(c[a],v);f+="\n<event week='"+v+"' day='"+j+"' type='"+o+"' x='"+m+"' y='"+p+"' width='"+r+"' height='"+q+"' len='"+s+"'>";o=="event"?(f+="<header><![CDATA["+g(c[a].childNodes[1].innerHTML)+"]]\></header>",k=b?i(c[a].childNodes[2],"color"):"",l=b?i(c[a].childNodes[2],"backgroundColor"):"",f+="<body backgroundColor='"+l+"' color='"+k+"'><![CDATA["+g(c[a].childNodes[2].innerHTML)+"]]\></body>"):(k=b?i(c[a],"color"):"",l=
b?i(c[a],"backgroundColor"):"",f+="<body backgroundColor='"+l+"' color='"+k+"'><![CDATA["+g(c[a].innerHTML)+"]]\></body>");f+="</event>"}}}}return f}function B(b,f,c,a,e,h,g){var k=!1;e=="fullcolor"&&(k=!0,e="color");e=e||"color";html_regexp=RegExp("<[^>]*>","g");newline_regexp=RegExp("<br[^>]*>","g");var l=d.uid(),i=document.createElement("div");i.style.display="none";document.body.appendChild(i);i.innerHTML='<form id="'+l+'" method="post" target="_blank" action="'+a+'" accept-charset="utf-8" enctype="application/x-www-form-urlencoded"><input type="hidden" name="mycoolxmlbody"/> </form>';
var m="";if(b){for(var n=d._date,p=d._mode,m=u("pages",e,h,g),q=new Date(b);+q<+f;q=d.date.add(q,1,c))d.setCurrentView(q,c),m+=F("page")+y().replace("\u2013","-")+z(k)+o("page");m+=o("pages");d.setCurrentView(n,p)}else m=u("data",e,h,g)+y().replace("\u2013","-")+z(k)+o("data");document.getElementById(l).firstChild.value=encodeURIComponent(m);document.getElementById(l).submit();i.parentNode.removeChild(i)}d.toPDF=function(b,d,c,a){return B.apply(this,[null,null,null,b,d,c,a])};d.toPDFRange=function(b,
f,c,a,e,g,i){typeof b=="string"&&(b=d.templates.api_date(b),f=d.templates.api_date(f));return B.apply(this,arguments)}})()});
